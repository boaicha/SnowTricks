{% extends 'base.html.twig' %}

{% block title %}Hello HomeController!{% endblock %}

{% block body %}*
    <html lang="en">
    <head>
        <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    </head>

    <body class="d-flex flex-column h-100">
        <main class="flex-shrink-0">
            <!-- Blog preview section-->
            <section class="py-5">
                <div class="container px-5 my-5">
                    <div class="row gx-5 justify-content-center">
                        <div class="col-lg-8 col-xl-6">
                            <div class="text-center">
                                <h2 class="fw-bolder">Liste des figures</h2>
                                <br>
                            </div>
                        </div>
                    </div>
                    <div class="row gx-5" id="tricks">
                        {% for trick in tricks %}
                            <div class="col-lg-4 mb-5 trick">
                                <div class="card h-100 shadow border-0">

                                    {% if trick.getImages().get(0) != null %}
                                    <img class="card-img-top" src="{{ asset('assets/uploads/tricks/') ~ trick.getImages().get(0).getImage() }}" alt="..."/>
                                        {% else %}
                                        <img class="card-img-top"
                                                                  src="{{ asset('assets/uploads/tricks/defaut.jpg')}}" alt="..."/>
                                            {% endif %}
                                    <div class="card-body p-4">
                                        <a>
                                            <div class="badge bg-primary bg-gradient rounded-pill mb-2">New</div>
                                            <p class="card-text mb-0">{{ trick.description }}</p>
                                            <a href="{{ path('trick_show', {'slug': trick.slug}) }}">Afficher le trick</a>
                                            {% if user != null %}
                                                <a href="{{ path('app_trick_edit', {'slug': trick.slug}) }}"><i class="bi bi-pencil-fill"></i></a>
                                                <a href="{{ path('app_trick_delete', {'slug': trick.slug}) }}" onclick="ask()"><i class="bi bi-trash" style="   "></i></a>
                                            {% endif %}
                                        </a>
                                    </div>



                                </div>
                            </div>
                        {% endfor %}
                    </div>
                    <section class="flex justify-center pt-5">
                        <button type="button" class="btn btn-primary" id="load-more-btn">Voir plus</button>
                    </section>
                </div>
            </section>
        </main>
    <script>
        function ask(){
            return alert("Etes-vous sur de vouloir supprimer ce post ?");
        }
    </script>
        {% block javascripts %}
{#            <script>#}
{#                document.addEventListener("DOMContentLoaded", function() {#}
{#                    const voirPlusButton = document.getElementById("voirPlusButton");#}
{#                    const hiddenElements = document.querySelectorAll(".hidden");#}
{#                    let startIndex = 5; // Vous pouvez ajuster le nombre initial d'éléments visibles#}

{#                    voirPlusButton.addEventListener("click", function() {#}
{#                        for (let i = startIndex; i < startIndex + 5 && i < hiddenElements.length; i++) {#}
{#                            hiddenElements[i].classList.remove("hidden");#}
{#                        }#}

{#                        startIndex += 4;#}

{#                        // Masquer le bouton "Voir plus" si tous les éléments sont affichés#}
{#                        if (startIndex >= hiddenElements.length) {#}
{#                            voirPlusButton.style.display = "none";#}
{#                        }#}
{#                    });#}
{#                });#}
{#            </script>#}

            <script>
                document.addEventListener('DOMContentLoaded', function() {
                    const loadMoreBtn = document.getElementById('load-more-btn');
                    const trickContainer = document.getElementById('tricks');

                    let offset = {{ tricks|length }}; // Initialize the offset with the number of tricks already displayed

                    loadMoreBtn.addEventListener('click', function() {
                        fetch(`/loadMoreTrick?offset=${offset}`)
                            .then(response => response.json())
                            .then(data => {
                                console.log(data);

                                // Append new tricks
                                data.forEach(item => {
                                    const trick = item; // Access the details of the trick in 'item'

                                    const trickDiv = document.createElement('div');
                                    trickDiv.classList.add('col-lg-4', 'mb-5', 'trick');

                                    trickDiv.innerHTML = `
                        <div class="card h-100 shadow border-0">
                            ${trick.images.length > 0 ?
                                        `<img class="card-img-top" src="{{ asset('assets/uploads/tricks/') }}${trick.images[0].image}" alt="..."/>` :
                                        `<img class="card-img-top" src="{{ asset('assets/uploads/tricks/defaut.jpg')}}" alt="..."/>`
                                    }
                            <div class="card-body p-4">
                                <a>
                                    <div class="badge bg-primary bg-gradient rounded-pill mb-2">New</div>
                                    <p class="card-text mb-0">${trick.description}</p>
                                </a>
                            </div>
                        </div>
                    `;
                                    trickContainer.appendChild(trickDiv);
                                });

                                offset += data.length; // Update the offset
                                console.log(offset);
                            })
                            .catch(error => {
                                console.error('Error:', error);
                            });
                    });
                });
            </script>

        {% endblock javascripts %}
    </body>
    </html>

{% endblock %}
