{% extends 'base.html.twig' %}

{% block title %}Hello HomeController!{% endblock %}

{% block body %}
    <html lang="en">
    <head>
        <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    </head>

    <body class="d-flex flex-column h-100">

        <main class="flex-shrink-0">
            <!-- Blog preview section-->
            <section class="py-5">
                <div class="container px-5 my-5">
                    <div class="row gx-5 justify-content-center">
                        <div class="col-lg-8 col-xl-6">
                            <div class="text-center">
                                <h2 class="fw-bolder">Le snowboard est adr√©naline et passion</h2>
                                <br>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="position-absolute end-0 translate-middle-y">
                    <svg id="scroll-down-btn" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-arrow-down-square" viewBox="0 0 16 16" style="display: none; cursor: pointer;">
                        <path fill-rule="evenodd" d="M15 2a1 1 0 0 0-1-1H2a1 1 0 0 0-1 1v12a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1zM0 2a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2zm8.5 2.5a.5.5 0 0 0-1 0v5.793L5.354 8.146a.5.5 0 1 0-.708.708l3 3a.5.5 0 0 0 .708 0l3-3a.5.5 0 0 0-.708-.708L8.5 10.293z"/>
                    </svg>
                </div>
                    <div class="row gx-5" id="tricks">
                        {% for trick in tricks %}
                            <div class="col-lg-4 mb-5 trick">
                                <div class="card h-100 shadow border-0">

                                    {% if trick.getImages().get(0) != null %}
                                    <img class="card-img-top" src="{{ asset('assets/uploads/tricks/') ~ trick.getImages().get(0).getImage() }}" alt="..."/>
                                        {% else %}
                                        <img class="card-img-top"
                                                                  src="{{ asset('assets/uploads/tricks/defaut.jpg')}}" alt="..."/>
                                            {% endif %}
                                    <div class="card-body p-4">
                                        <a>
                                            <p class="card-text mb-0"><a href="{{ path('trick_show', {'slug': trick.slug}) }}">{{ trick.slug }}</a></p>

                                            {% if user != null %}
                                                <div class="d-flex justify-content-end align-items-center mt-2">
                                                    <a href="{{ path('app_trick_edit', {'slug': trick.slug}) }}" class="me-3">
                                                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-pencil-fill" viewBox="0 0 16 16">
                                                            <path d="M12.854.146a.5.5 0 0 0-.707 0L10.5 1.793 14.207 5.5l1.647-1.646a.5.5 0 0 0 0-.708l-3-3zm.646 6.061L9.793 2.5 3.293 9H3.5a.5.5 0 0 1 .5.5v.5h.5a.5.5 0 0 1 .5.5v.5h.5a.5.5 0 0 1 .5.5v.5h.5a.5.5 0 0 1 .5.5v.207l6.5-6.5zm-7.468 7.468A.5.5 0 0 1 6 13.5V13h-.5a.5.5 0 0 1-.5-.5V12h-.5a.5.5 0 0 1-.5-.5V11h-.5a.5.5 0 0 1-.5-.5V10h-.5a.499.499 0 0 1-.175-.032l-.179.178a.5.5 0 0 0-.11.168l-2 5a.5.5 0 0 0 .65.65l5-2a.5.5 0 0 0 .168-.11l.178-.178z"/>
                                                        </svg>
                                                    </a>

                                                    <a href="{{ path('app_trick_delete', {'slug': trick.slug}) }}" onclick="ask()">
                                                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-trash" viewBox="0 0 16 16">
                                                            <path d="M5.5 5.5A.5.5 0 0 1 6 6v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5m2.5 0a.5.5 0 0 1 .5.5v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5m3 .5a.5.5 0 0 0-1 0v6a.5.5 0 0 0 1 0z"/>
                                                            <path d="M14.5 3a1 1 0 0 1-1 1H13v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V4h-.5a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1H6a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1h3.5a1 1 0 0 1 1 1zM4.118 4 4 4.059V13a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1V4.059L11.882 4zM2.5 3h11V2h-11z"/>
                                                        </svg>
                                                    </a>
                                                </div>
                                            {% endif %}
                                        </a>
                                    </div>




                                </div>
                            </div>
                        {% endfor %}
                    </div>
                    <section class="flex justify-center pt-5 position-absolute top-150 start-50 translate-middle">
                        <button type="button" class="btn btn-primary" id="load-more-btn" data-is-clicked="false">Voir plus</button>
                    </section>
{#                </div>#}
            </section>
            <div class="position-absolute end-0 translate-middle-y">
            <svg id="scroll-up-btn" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-arrow-up-square" viewBox="0 0 16 16">
                <path fill-rule="evenodd" d="M15 2a1 1 0 0 0-1-1H2a1 1 0 0 0-1 1v12a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1zM0 2a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2zm8.5 9.5a.5.5 0 0 1-1 0V5.707L5.354 7.854a.5.5 0 1 1-.708-.708l3-3a.5.5 0 0 1 .708 0l3 3a.5.5 0 0 1-.708.708L8.5 5.707z"/>
            </svg>
            </div>
        </main>
    <script>
        function ask(){
            return alert("Etes-vous sur de vouloir supprimer ce post ?");
        }
    </script>
        {% block javascripts %}


            <script>
                document.addEventListener('DOMContentLoaded', function() {

                    const loadMoreBtn = document.getElementById('load-more-btn');
                    const trickContainer = document.getElementById('tricks');

                    let offset = {{ tricks|length }}; // Initialize the offset with the number of tricks already displayed

                    loadMoreBtn.addEventListener('click', function() {
                        let isButtonClicked = loadMoreBtn.getAttribute('data-is-clicked') === 'true';

                        if (!isButtonClicked) {
                            // Perform your desired action here
                            console.log('Button clicked!');

                            // Set the data-is-clicked attribute to true
                            loadMoreBtn.setAttribute('data-is-clicked', 'true');
                        }

                        console.log("LOL : " + isButtonClicked);


                        if(isButtonClicked === true){


                            fetch(`/loadMoreTrick?offset=${offset}`)
                                .then(response => response.json())
                                .then(data => {


                                    // Append new tricks
                                    data.forEach(item => {

                                        const trick = item; // Access the details of the trick in 'item'
                                        console.log(trick.slug);
                                        const trickDiv = document.createElement('div');
                                        trickDiv.classList.add('col-lg-4', 'mb-5', 'trick');

                                        trickDiv.innerHTML = `
                            <div class="card h-100 shadow border-0">
                                ${trick.images.length > 0 ?
                                            `<img class="card-img-top" src="{{ asset('assets/uploads/tricks/') }}${trick.images[0].image}" alt="..."/>` :
                                            `<img class="card-img-top" src="{{ asset('assets/uploads/tricks/defaut.jpg')}}" alt="..."/>`
                                        }
                                <div class="card-body p-4">
                                    <a>
                                        <p class="card-text mb-0"><a href="/trick/${trick.slug}">${trick.slug}</a></p>
                                            {% if user != null %}
                                                <a href="/trick/${trick.slug}/edit"><i class="bi bi-pencil-fill"></i></a>
                                                <a href="/trick/${trick.slug}/delete" onclick="ask()"><i class="bi bi-trash" style="   "></i></a>
                                            {% endif %}
                                    </a>
                                </div>
                            </div>
                        `;
                                        trickContainer.appendChild(trickDiv);
                                    });

                                    offset += data.length; // Update the offset
                                    console.log(offset);
                                })
                                .catch(error => {
                                    console.error('Error:', error);
                                });

                            loadMoreBtn.setAttribute('data-is-clicked', 'false');
                    }
                    });

                });
            </script>

{#            scroll down button #}
            <script>
                document.addEventListener('DOMContentLoaded', function () {

                    // scroller vers le bas
                    const scrollDownBtn = document.getElementById('scroll-down-btn');

                    scrollDownBtn.style.display = 'block';

                    scrollDownBtn.addEventListener('click', function () {
                        //scrollDownBtn.style.display = 'none';
                        window.scrollTo({ top: document.body.scrollHeight, behavior: 'smooth' });
                    });

                    // scroller vers le haut
                    const scrollUpBtn = document.getElementById('scroll-up-btn');
                    scrollUpBtn.style.display = 'block';

                    scrollUpBtn.addEventListener('click', function () {
                        //scrollDownBtn.style.display = 'none';
                        window.scrollTo({ top: 0, behavior: 'smooth' });
                    });

                });
            </script>

        {% endblock javascripts %}
    </body>
    </html>

{% endblock %}
