{% extends 'base.html.twig' %}

{% block title %}Hello HomeController!{% endblock %}

{% block body %}
    <html lang="en">
    <head>
        <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    </head>

    <body class="d-flex flex-column h-100">
    <svg id="scroll-down-btn" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-arrow-down-square" viewBox="0 0 16 16" style="display: none; cursor: pointer;">
        <path fill-rule="evenodd" d="M15 2a1 1 0 0 0-1-1H2a1 1 0 0 0-1 1v12a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1zM0 2a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2zm8.5 2.5a.5.5 0 0 0-1 0v5.793L5.354 8.146a.5.5 0 1 0-.708.708l3 3a.5.5 0 0 0 .708 0l3-3a.5.5 0 0 0-.708-.708L8.5 10.293z"/>
    </svg>
        <main class="flex-shrink-0">
            <!-- Blog preview section-->
            <section class="py-5">
                <div class="container px-5 my-5">
                    <div class="row gx-5 justify-content-center">
                        <div class="col-lg-8 col-xl-6">
                            <div class="text-center">
                                <h2 class="fw-bolder">Liste des figures</h2>
                                <br>
                            </div>
                        </div>
                    </div>
                    <div class="row gx-5" id="tricks">
                        {% for trick in tricks %}
                            <div class="col-lg-4 mb-5 trick">
                                <div class="card h-100 shadow border-0">

                                    {% if trick.getImages().get(0) != null %}
                                    <img class="card-img-top" src="{{ asset('assets/uploads/tricks/') ~ trick.getImages().get(0).getImage() }}" alt="..."/>
                                        {% else %}
                                        <img class="card-img-top"
                                                                  src="{{ asset('assets/uploads/tricks/defaut.jpg')}}" alt="..."/>
                                            {% endif %}
                                    <div class="card-body p-4">
                                        <a>
                                            <div class="badge bg-primary bg-gradient rounded-pill mb-2">New</div>
                                            <p class="card-text mb-0">{{ trick.description }}</p>
                                            <a href=`/trick/{{trick.slug}}`>Afficher le trick</a>
                                            {% if user != null %}
                                                <a href="{{ path('app_trick_edit', {'slug': trick.slug}) }}"><i class="bi bi-pencil-fill"></i></a>
                                                <a href="{{ path('app_trick_delete', {'slug': trick.slug}) }}" onclick="ask()"><i class="bi bi-trash" style="   "></i></a>
                                            {% endif %}
                                        </a>
                                    </div>



                                </div>
                            </div>
                        {% endfor %}
                    </div>
                    <section class="flex justify-center pt-5">
                        <button type="button" class="btn btn-primary" id="load-more-btn" data-is-clicked="false">Voir plus</button>
                    </section>
                </div>
            </section>
        </main>
    <script>
        function ask(){
            return alert("Etes-vous sur de vouloir supprimer ce post ?");
        }
    </script>
        {% block javascripts %}


            <script>
                document.addEventListener('DOMContentLoaded', function() {

                    const loadMoreBtn = document.getElementById('load-more-btn');
                    const trickContainer = document.getElementById('tricks');

                    let offset = {{ tricks|length }}; // Initialize the offset with the number of tricks already displayed

                    loadMoreBtn.addEventListener('click', function() {
                        let isButtonClicked = loadMoreBtn.getAttribute('data-is-clicked') === 'true';

                        if (!isButtonClicked) {
                            // Perform your desired action here
                            console.log('Button clicked!');

                            // Set the data-is-clicked attribute to true
                            loadMoreBtn.setAttribute('data-is-clicked', 'true');
                        }

                        console.log("LOL : " + isButtonClicked);


                        if(isButtonClicked === true){


                            fetch(`/loadMoreTrick?offset=${offset}`)
                                .then(response => response.json())
                                .then(data => {


                                    // Append new tricks
                                    data.forEach(item => {

                                        const trick = item; // Access the details of the trick in 'item'
                                        console.log(trick.slug);
                                        const trickDiv = document.createElement('div');
                                        trickDiv.classList.add('col-lg-4', 'mb-5', 'trick');

                                        trickDiv.innerHTML = `
                            <div class="card h-100 shadow border-0">
                                ${trick.images.length > 0 ?
                                            `<img class="card-img-top" src="{{ asset('assets/uploads/tricks/') }}${trick.images[0].image}" alt="..."/>` :
                                            `<img class="card-img-top" src="{{ asset('assets/uploads/tricks/defaut.jpg')}}" alt="..."/>`
                                        }
                                <div class="card-body p-4">
                                    <a>
                                        <div class="badge bg-primary bg-gradient rounded-pill mb-2">New</div>
                                        <p class="card-text mb-0">${trick.description}</p>
                                        <a href="/trick/${trick.slug}">Afficher le trick</a>
                                            {% if user != null %}
                                                <a href="/trick/${trick.slug}/edit"><i class="bi bi-pencil-fill"></i></a>
                                                <a href="/trick/${trick.slug}/delete" onclick="ask()"><i class="bi bi-trash" style="   "></i></a>
                                            {% endif %}
                                    </a>
                                </div>
                            </div>
                        `;
                                        trickContainer.appendChild(trickDiv);
                                    });

                                    offset += data.length; // Update the offset
                                    console.log(offset);
                                })
                                .catch(error => {
                                    console.error('Error:', error);
                                });

                            loadMoreBtn.setAttribute('data-is-clicked', 'false');
                    }
                    });

                });
            </script>

{#            scroll down button #}
            <script>
                document.addEventListener('DOMContentLoaded', function () {
                    const scrollDownBtn = document.getElementById('scroll-down-btn');

                    scrollDownBtn.style.display = 'block';

                    scrollDownBtn.addEventListener('click', function () {
                        //scrollDownBtn.style.display = 'none';
                        window.scrollTo({ top: document.body.scrollHeight, behavior: 'smooth' });
                    });
                });
            </script>

        {% endblock javascripts %}
    </body>
    </html>

{% endblock %}
